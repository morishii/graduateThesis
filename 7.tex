\chapter{評価}
本章では，プロトタイプシステムの各モジュールについての性能評価と，システムをユーザーに使ってもらい遠隔作業を行なうユーザーテストを行う．

\section{評価実験の概要}
本節では，本研究で提案する加速度センサのみを用いた移動手段判定システムの評価実験の概要を述べる．
はじめに，評価実験を行う目的について説明をする．その後評価実験を行う手順について説明をする．

\subsection{目的}
% 前章の予備実験では，本システムに適用する特徴量の抽出手法と機械学習アルゴリズムの選定を，交差検証を用いて評価した．
% しかし，交差検証を用いた分類精度の評価では，実環境における本システムの分類精度の評価としては不十分である．
% そこで，本章では評価用データを用いて本システムの分類精度の評価を行い，実環境における本システムの有用性について考察する．
% また，教師データがないユーザを追加した場合の本システムの分類精度の評価を行い，
% さらに，ある端末で作成した教師データを他の端末にも適用出来るかを評価する．

% \subsection{手順}
% 評価実験手順は以下の通りである．
% \begin{itembox}[l]{評価実験手順}
%  \begin{enumerate}
%   \item 加速度データの収集
%   \item 特徴量の抽出
%   \item 機械学習による分類
%  \end{enumerate}
% \end{itembox}

% \subsubsection*{加速度データの収集}
% 予備実験と同様に，まず，本システムに適用する加速度データを収集した．
% Galaxy Nexusを使用し，７種類の移動手段（歩行，走行，自転車，電車，バス，自動車，その他）を行っている際の加速度データを被験者５人に計測してもらいそれぞれ約300秒間記録した．
% 被験者は慶應義塾大学徳田研究室の５名とした．
% また，スマートフォンの所持位置はズボンのポケットの中，カバンの中，手の上の３種類で記録した．
% ７種類の移動手段を３種類の所持位置で５名の被験者に約300秒間記録したため，合計約９時間分の加速度データを収集した．
% 評価実験では，この300秒間のデータの前半の150秒間のデータを教師データとして，
% 後半の150秒間を評価用データとして使用する．
% また，教師データがない被験者を新たに１名追加し，
% 同じようにGalaxy Nexusを使用し，７種類の移動手段（歩行，走行，自転車，電車，バス，自動車，その他）を行っている際の加速度データを150秒間記録し，評価用データとした．
% さらに，Galaxy Nexusで作成した教師データを他の端末にも適用出来るかを評価するため，
% 教師データとしてGalaxy Nexusを用いて加速度データを収集した５名の被験者に，
% HTC Sensation\cite{HTCSensation}を使用し，７種類の移動手段（歩行，走行，自転車，電車，バス，自動車，その他）を行っている際の加速度データを150秒間記録し，評価用データとした．

% \subsubsection*{特徴量の抽出}
% 次に，収集した加速度データから教師データを作成するために特徴量の抽出を行う．
% 評価実験では予備実験で分類精度が高かった時系列分割手法を用いて特徴量の抽出を行う．

% \subsubsection*{機械学習による分類}
% 最後に作成した教師データを用いて機械学習による分類を行う．
% 機械学習ソフトウェアのWekaに，収集した加速度データの前半150秒間から抽出した特徴量を教師データとしてセットする．
% 機械学習アルゴリズムとして，予備実験で分類精度が高かったRandom Forestを用いて分類を行う．
% 評価は，移動手段補正モジュールを使用した場合と使用しなかった場合の分類精度を求め，
% 収集した加速度データの後半150秒間を用いて評価を行う．
% また，教師データがないユーザを追加した場合の評価は，追加した１人の被験者の評価用データを用いて行った．
% Galaxy Nexusで作成した教師データを他の端末にも適用できるかを評価するために，
% HTC Sensationを用いて取得した評価用データを用いて評価を行った．

\section{結果}
% 教師データがあるユーザの場合と教師データがないユーザを追加した場合，異なる端末に変更した場合に分け，評価実験結果を示す．
% \subsection{教師データがあるユーザの場合}
% 結果を表\ref{eval1}に示す．
% 移動手段補正モジュールを使用しない場合の分類精度は95.13\%で
% 移動手段補正モジュールを使用した場合の分類精度は98.44\%だった．
% 移動手段補正モジュールを使用しない場合の混同行列を表\ref{matrix71}に，
% 移動手段補正モジュールを使用した場合の混同行列を表\ref{matrix72}に示す．

% 予備実験の交差検証を用いて評価を行った場合は99.04\%だったため，
% 評価用データを用いて分類精度は4\%ほど低下した．
% しかし，移動手段補正モジュールを使用することによって3.31\%分類精度を向上することが出来た．

% 　\begin{table}[htbp]
%  　\begin{center}
%  　\caption{教師データがあるユーザの場合の分類精度}
%  　\label{eval1}
%   　\begin{tabular}{l|r}
%     \hline
%   　 & 分類精度 \\
%     \hline
%     \hline
%   　移動手段補正モジュールなし & 95.13\% \\
%   　移動手段補正モジュールあり & 98.44\% \\
%     \hline
%     \end{tabular}
%  　\end{center}
% 　\end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データがあるユーザの場合の混同行列(移動手段補正モジュールなし)}
%  \label{matrix71}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%   \hline \hline
% 歩行 & 99.64\% & 0.18\% & 0.18\% & 0.00\% & 0.00\% & 0.00\% & 0.00\%　\\
% 走行 & 0.27\% & 99.73\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\%　\\
% 自転車 & 0.67\% & 0.00\% & 90.00\% & 0.00\% & 4.33\% & 5.00\% & 0.00\%　\\
% 電車 & 0.25\% & 0.00\% & 0.38\% & 89.50\% & 5.50\% & 0.75\% & 3.63\%　\\
% バス & 0.20\% & 0.00\% & 0.00\% & 5.60\% & 90.20\% & 3.20\% & 0.80\%　\\
% 自動車 & 0.00\% & 0.00\% & 0.50\% & 1.17\% & 4.50\% & 92.83\% & 1.00\%　\\
% その他 & 0.00\% & 0.00\% & 0.00\% & 1.13\% & 0.00\% & 2.00\% & 96.88\%　\\

%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データがあるユーザの場合の混同行列(移動手段補正モジュールあり)}
%  \label{matrix72}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%   \hline \hline
% 歩行 & 100.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 走行 & 0.18\% & 99.82\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 自転車 & 0.00\% & 0.00\% & 95.33\% & 0.00\% & 3.00\% & 1.67\% & 0.00\% \\
% 電車 & 0.13\% & 0.00\% & 0.00\% & 97.63\% & 0.75\% & 0.13\% & 1.38\% \\
% バス & 0.20\% & 0.00\% & 0.00\% & 3.40\% & 95.40\% & 0.80\% & 0.20\% \\
% 自動車 & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 2.33\% & 97.67\% & 0.00\% \\
% その他 & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 100.00\% \\
%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}

% \clearpage

% \subsection{教師データがないユーザを追加した場合}
% 結果を表\ref{eval2}に示す．
% 移動手段補正モジュールを使用しない場合の分類精度は9.78\%で
% 移動手段補正モジュールを使用した場合の分類精度は10.28\%だった．
% 移動手段補正モジュールを使用しない場合の混同行列を表\ref{matrix81}に，
% 移動手段補正モジュールを使用した場合の混同行列を表\ref{matrix82}に示す．

% 教師データが登録されてないユーザを追加した場合の分類精度は大きく低下した．
% 移動手段補正モジュールを使用しても，0.50\%しか分類精度は向上しなかった．


% 　\begin{table}[htbp]
%  　\begin{center}
%  　\caption{教師データがないユーザを追加した場合の分類精度}
%  　\label{eval2}
%   　\begin{tabular}{l|r}
%     \hline
%   　 & 分類精度 \\
%     \hline
%     \hline
%   　移動手段補正モジュールなし & 9.78\% \\
%   　移動手段補正モジュールあり & 10.28\% \\
%     \hline
%     \end{tabular}
%  　\end{center}
% 　\end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データがないユーザを追加した場合の混同行列(移動手段補正モジュールなし)}
%  \label{matrix81}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%   \hline \hline
% 歩行 & 0.00\% & 19.67\% & 0.00\% & 79.00\% & 0.00\% & 0.00\% & 1.33\% \\
% 走行 & 0.00\% & 0.00\% & 0.00\% & 9.67\% & 0.00\% & 0.00\% & 90.33\% \\
% 自転車 & 0.00\% & 0.00\% & 38.00\% & 41.50\% & 20.50\% & 0.00\% & 0.00\% \\
% 電車 & 0.00\% & 50.33\% & 5.00\% & 0.00\% & 34.33\% & 10.00\% & 0.33\% \\
% バス & 0.00\% & 22.67\% & 33.00\% & 8.33\% & 33.33\% & 2.67\% & 0.00\% \\
% 自動車 & 0.00\% & 4.00\% & 0.00\% & 0.00\% & 96.00\% & 0.00\% & 0.00\% \\
% その他 & 0.00\% & 53.50\% & 0.00\% & 0.00\% & 0.00\% & 46.50\% & 0.00\% \\
%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データがないユーザを追加した場合の混同行列(移動手段補正モジュールあり)}
%  \label{matrix82}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%   \hline \hline
% 歩行 & 0.00\% & 21.00\% & 0.00\% & 79.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 走行 & 0.00\% & 0.00\% & 0.00\% & 5.00\% & 0.00\% & 0.00\% & 95.00\% \\
% 自転車 & 0.00\% & 0.00\% & 42.50\% & 42.50\% & 15.00\% & 0.00\% & 0.00\% \\
% 電車 & 0.00\% & 59.67\% & 1.67\% & 0.00\% & 33.67\% & 5.00\% & 0.00\% \\
% バス & 0.00\% & 28.00\% & 33.33\% & 4.33\% & 33.33\% & 1.00\% & 0.00\% \\
% 自動車 & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 100.00\% & 0.00\% & 0.00\% \\
% その他 & 0.00\% & 51.50\% & 0.00\% & 0.00\% & 0.00\% & 48.50\% & 0.00\% \\
%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}


% \clearpage

% \subsection{教師データを作成した端末と異なる端末に変更した場合}
% 結果を表\ref{eval3}に示す．
% 移動手段補正モジュールを使用しない場合の分類精度は45.83\%で
% 移動手段補正モジュールを使用した場合の分類精度は47.28\%だった．
% 移動手段補正モジュールを使用しない場合の混同行列を表\ref{matrix91}に，
% 移動手段補正モジュールを使用した場合の混同行列を表\ref{matrix92}に示す．

% 教師データを作成した端末と異なる端末に変更したため，同じ端末を使用した時に比べ分類精度が半分程度に低下した．
% 混同行列から，歩行や走行，自転車の加速度変化の大きい移動手段は高い精度で分類できているが，他の移動手段の分類精度が低かった．

% 　\begin{table}[htbp]
%  　\begin{center}
%  　\caption{教師データを作成した端末と異なる端末に変更した場合の分類精度}
%  　\label{eval3}
%   　\begin{tabular}{l|r}
%     \hline
%   　 & 分類精度 \\
%     \hline
%     \hline
%   　移動手段補正モジュールなし & 45.83\% \\
%   　移動手段補正モジュールあり & 47.28\% \\
%     \hline
%     \end{tabular}
%  　\end{center}
% 　\end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データを作成した端末と異なる端末に変更した場合の混同行列(移動手段補正モジュールなし)}
%  \label{matrix91}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%     \hline \hline
% 歩行 & 91.40\% & 8.60\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 走行 & 0.00\% & 100.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 自転車 & 2.00\% & 0.00\% & 98.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 電車 & 0.00\% & 0.00\% & 0.00\% & 36.75\% & 5.00\% & 19.75\% & 38.50\% \\
% バス & 0.00\% & 0.00\% & 2.00\% & 41.67\% & 5.67\% & 22.00\% & 28.67\% \\
% 自動車 & 0.33\% & 0.00\% & 1.00\% & 49.67\% & 6.00\% & 43.00\% & 0.00\% \\
% その他 & 3.55\% & 40.55\% & 1.64\% & 13.09\% & 1.91\% & 13.55\% & 25.73\% \\
%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}

% \begin{table}[htbp]
%  \begin{center}
%  \caption{教師データを作成した端末と異なる端末に変更した場合の混同行列(移動手段補正モジュールあり)}
%  \label{matrix92}
%   \begin{tabular}{c|rrrrrrr}
%   \hline
%    & 歩行 & 走行 & 自転車 & 電車 & バス & 自動車 & その他 \\
%   \hline \hline

% 歩行 & 94.80\% & 5.20\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 走行 & 0.00\% & 100.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 自転車 & 0.00\% & 0.00\% & 100.00\% & 0.00\% & 0.00\% & 0.00\% & 0.00\% \\
% 電車 & 0.00\% & 0.00\% & 0.00\% & 40.25\% & 2.25\% & 22.00\% & 35.50\% \\
% バス & 0.00\% & 0.00\% & 2.00\% & 47.67\% & 3.33\% & 23.67\% & 23.33\% \\
% 自動車 & 0.33\% & 0.00\% & 0.67\% & 52.33\% & 4.00\% & 42.67\% & 0.00\% \\
% その他 & 0.64\% & 44.18\% & 0.36\% & 11.18\% & 1.27\% & 15.27\% & 27.09\% \\

%   \hline
%   \end{tabular}
%  \end{center}
% \end{table}

% \clearpage

% \section{考察}
% \subsubsection*{教師データがあるユーザの分類精度}
% 教師データがあるユーザの場合の評価は，
% 移動手段判定モジュールを使用しない場合が95.13\%, 
% 移動手段補正モジュールを使用した場合が98.44\%と
% 本研究が提案する加速度センサのみを用いた移動手段判定システムにおいて，
% 実環境で十分な移動手段の判定を行うことが出来ると言える．
% また，移動手段補正モジュールによって分類精度を高めることができ，
% 補正を行う目的を果たすことが出来た．
% 移動手段補正モジュールを使用した場合の混同行列から，
% 電車の分類精度は96.39\%, バスの場合は96.15\%, 自動車の場合は97.72\%
% と他の移動手段に比べ，分類精度はわずかに下がった．
% しかし，日常的に移動手段を判定する際には十分実用的な分類精度であると言える．

% \subsubsection*{移動手段補正モジュールで補正できない場合}
% 移動手段補正モジュールは「歩行→電車→歩行」と判定された場合に，
% 「歩行→歩行→歩行」と補正を行うモジュールである．
% しかし，歩行中に「歩行→歩行→電車→バス→歩行」と２回以上連続判定を誤った場合などは，
% 補正を行うことが出来ない．（図\ref{filter2}）
% \begin{figure}[htbp]
%   \begin{center}
%    \includegraphics[width=150mm]{image/7/filter2.eps}
%    \caption{移動手段補正モジュールで補正できない例}
%    \label{filter2}
%   \end{center}
% \end{figure}
% このような場合があったため，補正をすべて行うことが出来ず，98.44\%という結果だったと考えられる．
% 移動手段補正モジュールでは１つ次の移動手段の判定が終わった後に補正を行っている．
% これを２つ次の移動手段の判定が終わった後に補正を行えば，
% 上記の問題を解決することが出来る．
% しかし，補正を行う際にあとで判定された移動手段を多く用いてしまうと，
% 最終的な移動手段の判定に時間がかかってしまい，リアルタイム性が損なわれる．
% リアルタイム性が必要な場合とそうでない場合の移動手段の活用によって，
% 補正を行う際のウィンドウ幅を変えるなどして，使い分ける必要があると考えた．

% \subsubsection*{教師データがないユーザの分類精度}
% 教師データがないユーザを追加した場合は9.78\%と大きく低下してしまった．
% 人によって，スマートフォンの持ち方が違ったり，
% 歩き方や走り方が違ったりしているためにこのような結果と考えられる．
% 移動手段補正モジュールを使用して10.28\%に分類精度は高まったが，
% ほとんどが間違った補正をしていた．
% 移動手段判定モジュールでの分類精度が高く無ければ，
% 移動手段補正モジュールでの補正が効果的ではなかった．
% 本研究で提案する加速度センサのみを用いた移動手段判定システムでは，
% ユーザごとに教師データを作成し，移動手段の判定を行う必要があった．

% \subsubsection*{教師データを作成した端末と異なる端末に変更した場合の分類精度}
% 異なる端末に変更した場合の分類精度は45.83\%だった．
% 端末に搭載されている加速度センサが異なるために
% 分類精度が低下してしまったと考えられる．
% しかし，混同行列から，歩行や走行，自転車の加速度変化の大きい移動手段は高い精度で分類できていた．
% 本システムで歩行や走行，自転車を判定する際には，
% 端末ごとに教師データを作成する必要が無いが，
% それ以外の移動手段では端末ごとに教師データを作成する必要があると言える．


\section{まとめ}
本章では，加速度センサのみを用いた移動手段判定システムの評価実験を行った．
評価実験の結果，教師データがあるユーザの場合の分類精度は98.44\%であった．
次章では，本研究における今後の展望と本論文のまとめを述べる．